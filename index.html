<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Âè∞ÁÅ£Â∞èÂêÉÂ∫ó - LINE Âø´ÈÄüË®ÇÈ§ê</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body {
            background-color: #f7fafc;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        input, textarea, select {
            -webkit-user-select: text;
            user-select: text;
        }
        @keyframes slide-in {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .animate-slide-in { animation: slide-in 0.3s ease-out forwards; }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fade-in 0.5s ease-out; }
        .clickable-btn {
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            user-select: none;
        }
        .clickable-btn:active {
            transform: scale(0.95);
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="min-h-screen flex items-center justify-center p-4">
            <div class="text-center">
                <div class="text-6xl mb-4">‚è≥</div>
                <p class="text-gray-600">ËºâÂÖ•Ë®ÇÈ§êÂäüËÉΩ‰∏≠...</p>
            </div>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useCallback, useEffect, useMemo } = React;

        // ÈÖçÁΩÆ - ÂæûÁí∞Â¢ÉËÆäÊï∏ËÆÄÂèñÔºåÁ¢∫‰øùÊïèÊÑüË≥áË®ä‰∏çÊö¥Èú≤
        const LIFF_ID = process.env.NEXT_PUBLIC_LIFF_ID;
        const API_ENDPOINT = process.env.NEXT_PUBLIC_API_ENDPOINT;
        const DELIVERY_FEE = 30;

        // Áí∞Â¢ÉËÆäÊï∏Ê™¢Êü•
        if (!LIFF_ID || !API_ENDPOINT) {
            console.warn('Áí∞Â¢ÉËÆäÊï∏Êú™Ê≠£Á¢∫Ë®≠ÂÆöÔºåË´ãÊ™¢Êü• Vercel Áí∞Â¢ÉËÆäÊï∏Ë®≠ÂÆö');
        }

        // ÈªòË™çËèúÂñÆ
        const DEFAULT_MENU = [
            { name: 'Êª∑ËÇâÈ£Ø', price: 35, icon: 'üçö', status: '‰æõÊáâ‰∏≠' },
            { name: 'ÈõûËÇâÈ£Ø', price: 40, icon: 'üçó', status: '‰æõÊáâ‰∏≠' },
            { name: 'Ëöµ‰ªîÁÖé', price: 65, icon: 'üç≥', status: '‰æõÊáâ‰∏≠' },
            { name: 'Â§ßËÖ∏È∫µÁ∑ö', price: 50, icon: 'üçú', status: '‰æõÊáâ‰∏≠' },
            { name: 'ÁèçÁè†Â•∂Ëå∂', price: 45, icon: 'ü•§', status: '‰æõÊáâ‰∏≠' }
        ];

        // API ÊúçÂãô
        const apiService = {
            async request(payload) {
                try {
                    console.log('ÁôºÈÄÅË´ãÊ±ÇÂà∞ Google Sheets:', payload);
                    
                    if (!API_ENDPOINT) {
                        throw new Error('API Á´ØÈªûÊú™Ë®≠ÂÆö');
                    }
                    
                    const response = await fetch(API_ENDPOINT, {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(payload)
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ÈåØË™§! ÁãÄÊÖã: ${response.status}`);
                    }
                    
                    const result = await response.json();
                    console.log('Google Sheets ÂõûÊáâ:', result);
                    return result;
                } catch (error) {
                    console.error('API Ë´ãÊ±ÇÂ§±Êïó:', error);
                    throw new Error('Á∂≤Ë∑ØÈÄ£Á∑öÂ§±ÊïóÔºåË´ãÊ™¢Êü•Á∂≤Ë∑ØÈÄ£Á∑ö');
                }
            },

            async getMenu() {
                try {
                    const result = await this.request({ action: 'getMenu' });
                    if (result.success && Array.isArray(result.data)) {
                        return result.data;
                    }
                    return DEFAULT_MENU;
                } catch (error) {
                    console.warn('Áç≤ÂèñËèúÂñÆÂ§±ÊïóÔºå‰ΩøÁî®ÈªòË™çËèúÂñÆ:', error);
                    return DEFAULT_MENU;
                }
            },
            
            async submitOrder(orderData) {
                try {
                    const orderDataForServer = {
                        action: 'createOrder',
                        customerName: orderData.customerName.trim(),
                        customerPhone: orderData.customerPhone.trim(),
                        items: orderData.items.map(item => `${item.name} x${item.quantity}`).join(', '),
                        itemsDetail: orderData.items.map(item => ({
                            name: item.name,
                            quantity: item.quantity,
                            price: item.price
                        })),
                        totalAmount: orderData.totalAmount,
                        pickupTime: orderData.pickupTime,
                        deliveryAddress: orderData.deliveryAddress.trim(),
                        notes: orderData.notes.trim(),
                        orderId: 'ORD_' + Date.now()
                    };

                    console.log('Êèê‰∫§Ë®ÇÂñÆÊï∏ÊìöÂà∞ Google Sheets:', orderDataForServer);

                    const result = await this.request(orderDataForServer);

                    if (!result.success) {
                        throw new Error(result.message || 'Ë®ÇÂñÆÊèê‰∫§Â§±Êïó');
                    }

                    return {
                        ...result,
                        data: {
                            orderId: orderDataForServer.orderId,
                            totalAmount: orderData.totalAmount
                        }
                    };
                } catch (error) {
                    console.error('Êèê‰∫§Ë®ÇÂñÆÂà∞ Google Sheets Â§±Êïó:', error);
                    throw error;
                }
            },

            async getOrders(params) {
                try {
                    const searchParams = {
                        action: 'getOrders',
                        customerName: params.customerName.trim(),
                        customerPhone: params.customerPhone ? params.customerPhone.trim() : '',
                        startDate: params.startDate,
                        endDate: params.endDate
                    };

                    const result = await this.request(searchParams);

                    if (!result.success) {
                        throw new Error(result.message || 'Êü•Ë©¢Â§±Êïó');
                    }

                    return result.data || [];
                } catch (error) {
                    console.error('Êü•Ë©¢Ë®ÇÂñÆÂ§±Êïó:', error);
                    throw error;
                }
            }
        };

        // LINE LIFF Hook
        const useLiff = () => {
            const [profile, setProfile] = useState(null);
            const [idToken, setIdToken] = useState(null);
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [liffStatus, setLiffStatus] = useState('üîÑ ÂàùÂßãÂåñ LINE ÂäüËÉΩ‰∏≠...');
            const [statusType, setStatusType] = useState('info');

            useEffect(() => {
                const initializeLiff = async () => {
                    try {
                        if (!LIFF_ID) {
                            setLiffStatus('‚ö†Ô∏è LINE ÂäüËÉΩÊú™Ë®≠ÂÆöÔºåË´ãÊ™¢Êü•Áí∞Â¢ÉËÆäÊï∏');
                            setStatusType('warning');
                            return;
                        }

                        console.log('Ê≠£Âú®ÂàùÂßãÂåñ LINE LIFF...');
                        await liff.init({ liffId: LIFF_ID });
                        
                        if (liff.isLoggedIn()) {
                            setIsLoggedIn(true);
                            const [userProfile, token] = await Promise.all([
                                liff.getProfile(),
                                liff.getIDToken()
                            ]);
                            setProfile(userProfile);
                            setIdToken(token);
                            setLiffStatus(`üëã Ê≠°ËøéÔºå${userProfile.displayName}ÔºÅ`);
                            setStatusType('success');
                        } else {
                            setLiffStatus('Ë´ãÂú® LINE App ‰∏≠ÈñãÂïü‰ª•Áç≤ÂæóÂÆåÊï¥ÂäüËÉΩ„ÄÇ');
                            setStatusType('warning');
                        }
                    } catch (error) {
                        console.warn('LINE ÂàùÂßãÂåñÂ§±Êïó:', error);
                        setLiffStatus('‚ö†Ô∏è LINE ÂäüËÉΩËºâÂÖ•Â§±ÊïóÔºå‰ΩÜÊÇ®‰ªçÂèØË®ÇÈ§ê„ÄÇ');
                        setStatusType('warning');
                    }
                };
                
                if (window.liff) {
                    initializeLiff();
                } else {
                    setLiffStatus('‚ö†Ô∏è LINE SDK ËºâÂÖ•Â§±ÊïóÔºå‰ΩÜÊÇ®‰ªçÂèØË®ÇÈ§ê„ÄÇ');
                    setStatusType('warning');
                }
            }, []);

            return { profile, idToken, isLoggedIn, liffStatus, statusType };
        };

        // Âä†ËºâÂãïÁï´ÁµÑ‰ª∂
        const LoadingSpinner = () => {
            return React.createElement('svg', {
                className: 'animate-spin -ml-1 mr-3 h-5 w-5',
                xmlns: 'http://www.w3.org/2000/svg',
                fill: 'none',
                viewBox: '0 0 24 24'
            },
                React.createElement('circle', {
                    className: 'opacity-25',
                    cx: '12',
                    cy: '12',
                    r: '10',
                    stroke: 'currentColor',
                    strokeWidth: '4'
                }),
                React.createElement('path', {
                    className: 'opacity-75',
                    fill: 'currentColor',
                    d: 'M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z'
                })
            );
        };

        // ÈÄöÁü•ÁµÑ‰ª∂
        const Notification = ({ message, type, visible, onClose }) => {
            useEffect(() => {
                if (visible) {
                    const timer = setTimeout(onClose, 4000);
                    return () => clearTimeout(timer);
                }
            }, [visible, onClose]);

            if (!visible) return null;
            
            const typeClasses = {
                success: "bg-green-500 text-white",
                error: "bg-red-500 text-white",
                warning: "bg-yellow-500 text-white",
                info: "bg-blue-500 text-white"
            };
            
            return React.createElement('div', {
                className: `fixed top-5 right-5 max-w-sm p-4 rounded-lg shadow-lg z-50 animate-slide-in ${typeClasses[type]}`
            },
                React.createElement('div', { className: 'flex justify-between items-center' },
                    React.createElement('p', { className: 'text-sm font-medium whitespace-pre-wrap' }, message),
                    React.createElement('button', {
                        onClick: onClose,
                        className: 'ml-4 text-xl font-bold leading-none'
                    }, '√ó')
                )
            );
        };

        // ËèúÂìÅÈ†ÖÁõÆÁµÑ‰ª∂
        const MenuItem = ({ item, cartQuantity, onUpdateCart }) => {
            return React.createElement('div', { 
                className: 'bg-white rounded-lg p-4 border border-gray-200 shadow-sm mb-3' 
            },
                React.createElement('div', { className: 'flex justify-between items-start mb-3' },
                    React.createElement('div', null,
                        React.createElement('h3', { className: 'font-bold text-gray-800 text-sm' }, 
                            `${item.icon} ${item.name}`
                        ),
                        React.createElement('p', { className: 'text-green-600 font-bold text-sm' }, 
                            `$${item.price}`
                        )
                    ),
                    React.createElement('span', { 
                        className: 'text-xs px-2 py-1 rounded-full bg-green-100 text-green-800'
                    }, item.status)
                ),
                
                React.createElement('div', { className: 'flex items-center gap-3' },
                    React.createElement('button', {
                        onClick: () => onUpdateCart(item.name, -1),
                        disabled: cartQuantity === 0,
                        className: `w-8 h-8 rounded-full flex items-center justify-center text-white font-bold clickable-btn ${
                            cartQuantity === 0 ? 'bg-gray-400 cursor-not-allowed' : 'bg-red-500 hover:bg-red-600'
                        }`
                    }, '-'),
                    
                    React.createElement('span', { 
                        className: 'min-w-8 text-center font-bold text-lg'
                    }, cartQuantity),
                    
                    React.createElement('button', {
                        onClick: () => onUpdateCart(item.name, 1),
                        className: 'w-8 h-8 rounded-full bg-green-500 text-white font-bold hover:bg-green-600 clickable-btn'
                    }, '+')
                )
            );
        };

        // Ê≠∑Âè≤Ë®ÇÂñÆÈ†ÅÈù¢
        const HistoryPage = ({ onBack, showNotification }) => {
            const { idToken, profile } = useLiff();
            const [startDate, setStartDate] = useState(() => {
                const d = new Date();
                d.setDate(d.getDate() - 7);
                return d.toISOString().split('T')[0];
            });
            const [endDate, setEndDate] = useState(() => new Date().toISOString().split('T')[0]);
            const [customerName, setCustomerName] = useState('');
            const [customerPhone, setCustomerPhone] = useState('');
            const [orders, setOrders] = useState([]);
            const [isLoading, setIsLoading] = useState(false);

            useEffect(() => {
                if (profile?.displayName) {
                    setCustomerName(profile.displayName);
                }
            }, [profile]);

            const handleSearch = async () => {
                if (!customerName.trim()) {
                    showNotification('Ë´ãËº∏ÂÖ•È°ßÂÆ¢ÂßìÂêç', 'error');
                    return;
                }
                
                setIsLoading(true);
                try {
                    const params = {
                        customerName: customerName.trim(),
                        customerPhone: customerPhone.trim(),
                        startDate: startDate,
                        endDate: endDate
                    };

                    const result = await apiService.getOrders(params);
                    setOrders(result.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()));
                    showNotification(`ÊâæÂà∞ ${result.length} Á≠ÜË®ÇÂñÆ`, 'success');
                } catch (error) {
                    showNotification(`Êü•Ë©¢Â§±ÊïóÔºö${error.message}`, 'error');
                    setOrders([]);
                } finally {
                    setIsLoading(false);
                }
            };

            return React.createElement('div', { className: 'animate-fade-in' },
                React.createElement('div', { className: 'flex justify-between items-center mb-4' },
                    React.createElement('h2', { className: 'text-xl font-bold text-gray-800' }, 'Ë®ÇÂñÆÁ¥ÄÈåÑÊü•Ë©¢'),
                    React.createElement('button', {
                        onClick: onBack,
                        className: 'text-sm bg-gray-200 hover:bg-gray-300 text-gray-700 py-1 px-3 rounded-lg clickable-btn'
                    }, 'ËøîÂõûË®ÇÈ§ê')
                ),
                
                React.createElement('div', { className: 'grid grid-cols-1 gap-4 mb-4 p-4 bg-gray-50 rounded-lg border' },
                    React.createElement('div', null,
                        React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'È°ßÂÆ¢ÂßìÂêç *'),
                        React.createElement('input', {
                            type: 'text',
                            value: customerName,
                            onChange: e => setCustomerName(e.target.value),
                            placeholder: 'Ë´ãËº∏ÂÖ•ÂÆåÊï¥ÂßìÂêç',
                            className: 'w-full p-2 border border-gray-300 rounded-md'
                        })
                    ),
                    
                    React.createElement('div', null,
                        React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'ÊâãÊ©üËôüÁ¢º'),
                        React.createElement('input', {
                            type: 'tel',
                            value: customerPhone,
                            onChange: e => setCustomerPhone(e.target.value),
                            placeholder: '0936123456',
                            className: 'w-full p-2 border border-gray-300 rounded-md'
                        })
                    ),
                    
                    React.createElement('div', { className: 'grid grid-cols-2 gap-4' },
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'ÈñãÂßãÊó•Êúü'),
                            React.createElement('input', {
                                type: 'date',
                                value: startDate,
                                onChange: e => setStartDate(e.target.value),
                                className: 'w-full p-2 border border-gray-300 rounded-md'
                            })
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'ÁµêÊùüÊó•Êúü'),
                            React.createElement('input', {
                                type: 'date',
                                value: endDate,
                                onChange: e => setEndDate(e.target.value),
                                className: 'w-full p-2 border border-gray-300 rounded-md'
                            })
                        )
                    ),
                    
                    React.createElement('div', null,
                        React.createElement('button', {
                            onClick: handleSearch,
                            disabled: isLoading,
                            className: 'w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg disabled:bg-gray-400 flex items-center justify-center clickable-btn'
                        },
                            isLoading ? [
                                React.createElement(LoadingSpinner, { key: 'spinner' }),
                                React.createElement('span', { key: 'text' }, 'Êü•Ë©¢‰∏≠...')
                            ] : 'üîç ÊêúÂ∞ãË®ÇÂñÆ'
                        )
                    )
                ),

                React.createElement('div', { className: 'space-y-4 max-h-[60vh] overflow-y-auto p-1' },
                    !isLoading && orders.length === 0 && React.createElement('div', {
                        className: 'text-center text-gray-500 py-10 italic'
                    },
                        React.createElement('p', null, 'Ë´ãËº∏ÂÖ•ÊêúÂ∞ãÊ¢ù‰ª∂ÈÄ≤Ë°åÊü•Ë©¢')
                    ),
                    orders.map(order => 
                        React.createElement('div', {
                            key: order.orderId,
                            className: 'bg-white p-4 rounded-lg shadow border border-gray-200'
                        },
                            React.createElement('div', { className: 'flex justify-between items-start border-b pb-2 mb-2' },
                                React.createElement('div', null,
                                    React.createElement('p', { className: 'text-xs text-gray-500' }, 'Ë®ÇÂñÆÁ∑®Ëôü'),
                                    React.createElement('p', { className: 'font-bold text-gray-800 text-sm' }, order.orderId)
                                ),
                                React.createElement('div', { className: 'text-right' },
                                    React.createElement('p', { className: 'text-xs text-gray-500' }, 'Ë®ÇÂñÆÈáëÈ°ç'),
                                    React.createElement('p', { className: 'font-bold text-green-600 text-lg' }, `$${order.totalAmount}`)
                                )
                            ),
                            React.createElement('div', { className: 'text-sm space-y-1 text-gray-600' },
                                React.createElement('p', null, 
                                    React.createElement('strong', null, 'È°ßÂÆ¢ÂßìÂêç:'),
                                    ` ${order.customerName}`
                                ),
                                React.createElement('p', null,
                                    React.createElement('strong', null, 'ÊâãÊ©üËôüÁ¢º:'),
                                    ` ${order.customerPhone}`
                                ),
                                React.createElement('p', null,
                                    React.createElement('strong', null, '‰∏ãÂñÆÊôÇÈñì:'),
                                    ` ${new Date(order.createdAt).toLocaleString('zh-TW')}`
                                ),
                                React.createElement('p', null,
                                    React.createElement('strong', null, 'È†êË®àÂèñÈ§ê:'),
                                    ` ${new Date(order.pickupTime).toLocaleString('zh-TW')}`
                                ),
                                React.createElement('p', null,
                                    React.createElement('strong', null, 'Ë®ÇÂñÆÂÖßÂÆπ:'),
                                    ` ${order.items}`
                                ),
                                order.deliveryAddress && React.createElement('p', null,
                                    React.createElement('strong', null, 'Â§ñÈÄÅÂú∞ÂùÄ:'),
                                    ` ${order.deliveryAddress}`
                                ),
                                order.notes && React.createElement('p', null,
                                    React.createElement('strong', null, 'ÂÇôË®ª:'),
                                    ` ${order.notes}`
                                )
                            )
                        )
                    )
                )
            );
        };

        // ÊàêÂäüÈ†ÅÈù¢
        const SuccessPage = ({ orderData, onNewOrder, showNotification }) => {
            const formatDisplayTime = (timestamp) => new Date(timestamp).toLocaleString('zh-TW');
            
            const shareTextContent = `üçΩÔ∏è Âè∞ÁÅ£Â∞èÂêÉÂ∫ó - Ë®ÇÂñÆÁ¢∫Ë™ç\n\nüìã Ë®ÇÂñÆÁ∑®ËôüÔºö${orderData.orderId}\nüë§ È°ßÂÆ¢ÂßìÂêçÔºö${orderData.customerName}\nüìû ËÅØÁµ°ÈõªË©±Ôºö${orderData.customerPhone}\n\nüí∞ ÊúÄÁµÇÁ∏ΩÈáëÈ°çÔºö$${orderData.totalAmount}\n‚è∞ ÂèñÈ§êÊôÇÈñìÔºö${formatDisplayTime(orderData.pickupTime)}\nüìç ${orderData.deliveryAddress ? `Â§ñÈÄÅÂú∞ÂùÄÔºö${orderData.deliveryAddress}` : 'Ëá™Âèñ'}\nüìù ÂÇôË®ªÔºö${orderData.notes || 'ÁÑ°'}\n\nüìç ÂèñÈ§êÂú∞ÂùÄÔºöÂè∞ÁÅ£Â∞èÂêÉÂ∫ó\nüïí ÁáüÊ•≠ÊôÇÈñìÔºö10:00-21:00\nüìû ËÅØÁµ°ÈõªË©±Ôºö02-1234-5678`;

            const copyShareText = () => {
                navigator.clipboard.writeText(shareTextContent)
                    .then(() => showNotification('Ë®ÇÂñÆË≥áË®äÂ∑≤Ë§áË£ΩÔºÅ', 'success'))
                    .catch(() => showNotification('Ë§áË£ΩÂ§±Êïó', 'error'));
            };

            return React.createElement('div', { className: 'text-center p-5 animate-fade-in' },
                React.createElement('div', { className: 'text-6xl mb-5' }, '‚úÖ'),
                React.createElement('h3', { className: 'text-2xl font-bold text-green-600 mb-4' }, 'Ë®ÇÂñÆÊèê‰∫§ÊàêÂäüÔºÅ'),
                React.createElement('div', { className: 'bg-gray-50 p-4 rounded-lg my-5 text-left border' },
                    React.createElement('p', null, 
                        React.createElement('strong', null, 'Ë®ÇÂñÆÁ∑®ËôüÔºö'),
                        React.createElement('span', { className: 'font-mono' }, orderData.orderId)
                    ),
                    React.createElement('p', null, 
                        React.createElement('strong', null, 'È°ßÂÆ¢ÂßìÂêçÔºö'),
                        React.createElement('span', null, orderData.customerName)
                    ),
                    React.createElement('p', null, 
                        React.createElement('strong', null, 'ËÅØÁµ°ÈõªË©±Ôºö'),
                        React.createElement('span', null, orderData.customerPhone)
                    ),
                    React.createElement('p', null, 
                        React.createElement('strong', null, 'ÊúÄÁµÇÁ∏ΩÈáëÈ°çÔºö'),
                        '$',
                        React.createElement('span', { className: 'text-green-600 font-bold' }, orderData.totalAmount)
                    ),
                    React.createElement('p', null, 
                        React.createElement('strong', null, 'ÂèñÈ§êÊôÇÈñìÔºö'),
                        React.createElement('span', null, formatDisplayTime(orderData.pickupTime))
                    ),
                    React.createElement('p', null, 
                        React.createElement('strong', null, 'ÂèñÈ§êÊñπÂºèÔºö'),
                        React.createElement('span', null, orderData.deliveryAddress ? 'Â§ñÈÄÅ' : 'Ëá™Âèñ')
                    ),
                    orderData.deliveryAddress && React.createElement('p', null, 
                        React.createElement('strong', null, 'Â§ñÈÄÅÂú∞ÂùÄÔºö'),
                        React.createElement('span', null, orderData.deliveryAddress)
                    ),
                    orderData.notes && React.createElement('p', null, 
                        React.createElement('strong', null, 'ÂÇôË®ªÔºö'),
                        React.createElement('span', null, orderData.notes)
                    )
                ),
                React.createElement('div', { className: 'my-8' },
                    React.createElement('p', { className: 'text-lg font-bold mb-4' }, 'üì± ÂàÜ‰∫´Ë®ÇÂñÆË≥áË®ä'),
                    React.createElement('a', {
                        href: `https://line.me/R/msg/text/?${encodeURIComponent(shareTextContent)}`,
                        target: '_blank',
                        rel: 'noopener noreferrer',
                        className: 'inline-block my-4 p-2.5 bg-[#06c755] rounded-lg clickable-btn'
                    },
                        React.createElement('img', {
                            src: 'https://scdn.line-apps.com/n/line_add_friends/btn/zh-Hant.png',
                            alt: 'ÂàÜ‰∫´Âà∞ LINE',
                            className: 'h-10'
                        })
                    ),
                    React.createElement('div', { className: 'mt-6' },
                        React.createElement('button', {
                            onClick: copyShareText,
                            className: 'bg-blue-500 text-white border-none py-2 px-5 rounded-md cursor-pointer hover:bg-blue-600 clickable-btn'
                        }, 'üìã Ë§áË£ΩË®ÇÂñÆË≥áË®ä')
                    )
                ),
                React.createElement('button', {
                    onClick: onNewOrder,
                    className: 'bg-green-600 text-white border-none py-3 px-8 rounded-md cursor-pointer text-base mt-5 hover:bg-green-700 clickable-btn'
                }, 'üìù ÂÜçË®Ç‰∏ÄÂñÆ')
            );
        };

        // Ë®ÇÈ§êÈ†ÅÈù¢
        const OrderPage = ({ menuItems, onSubmitOrder, showNotification, onViewHistory }) => {
            const { profile, idToken, liffStatus, statusType } = useLiff();
            const [cart, setCart] = useState([]);
            const [isLoading, setIsLoading] = useState(false);
            const [customerName, setCustomerName] = useState('');
            const [customerPhone, setCustomerPhone] = useState('');
            const [pickupDate, setPickupDate] = useState('');
            const [pickupTime, setPickupTime] = useState('');
            const [deliveryAddress, setDeliveryAddress] = useState('');
            const [notes, setNotes] = useState('');

            useEffect(() => {
                const now = new Date();
                const today = now.toISOString().split('T')[0];
                setPickupDate(today);
                
                now.setMinutes(now.getMinutes() + 30);
                const minutes = Math.ceil(now.getMinutes() / 30) * 30;
                now.setMinutes(minutes);
                const timeString = now.toTimeString().slice(0, 5);
                setPickupTime(timeString);
            }, []);

            useEffect(() => {
                if (profile?.displayName) {
                    setCustomerName(profile.displayName);
                }
            }, [profile]);

            const { subtotal, deliveryFee, totalAmount } = useMemo(() => {
                const sub = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
                const fee = deliveryAddress.trim() ? DELIVERY_FEE : 0;
                return { subtotal: sub, deliveryFee: fee, totalAmount: sub + fee };
            }, [cart, deliveryAddress]);

            const updateCart = (itemName, change) => {
                setCart(prevCart => {
                    const existingIndex = prevCart.findIndex(item => item.name === itemName);
                    
                    if (existingIndex === -1) {
                        if (change > 0) {
                            const menuItem = menuItems.find(item => item.name === itemName);
                            return menuItem ? [...prevCart, { ...menuItem, quantity: 1 }] : prevCart;
                        }
                        return prevCart;
                    }
                    
                    const newCart = [...prevCart];
                    const currentQuantity = newCart[existingIndex].quantity;
                    const newQuantity = currentQuantity + change;
                    
                    if (newQuantity <= 0) {
                        newCart.splice(existingIndex, 1);
                    } else {
                        newCart[existingIndex] = { ...newCart[existingIndex], quantity: newQuantity };
                    }
                    
                    return newCart;
                });
            };

            const getItemQuantity = (itemName) => {
                const item = cart.find(item => item.name === itemName);
                return item ? item.quantity : 0;
            };

            const clearCart = () => {
                if (window.confirm('Á¢∫ÂÆöË¶ÅÊ∏ÖÁ©∫Ë≥ºÁâ©ËªäÂóéÔºü')) {
                    setCart([]);
                }
            };

            const getDateOptions = () => {
                const dates = [];
                const today = new Date();
                
                for (let i = 0; i < 7; i++) {
                    const date = new Date(today);
                    date.setDate(today.getDate() + i);
                    dates.push({
                        value: date.toISOString().split('T')[0],
                        label: date.toLocaleDateString('zh-TW', { month: 'long', day: 'numeric', weekday: 'short' })
                    });
                }
                
                return dates;
            };

            const getTimeOptions = () => {
                const times = [];
                for (let hour = 10; hour <= 21; hour++) {
                    for (let minute = 0; minute < 60; minute += 30) {
                        times.push(`${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`);
                    }
                }
                return times;
            };

            const getFullPickupTime = () => {
                return pickupDate && pickupTime ? `${pickupDate}T${pickupTime}` : '';
            };

            const validateForm = () => {
                if (!customerName.trim()) {
                    showNotification('Ë´ãÂ°´ÂØ´ÂßìÂêç', 'error');
                    return false;
                }
                if (!/^09\d{8}$/.test(customerPhone)) {
                    showNotification('Ë´ãËº∏ÂÖ•ÊúâÊïàÁöÑ10‰ΩçÊâãÊ©üËôüÁ¢º (09ÈñãÈ†≠)', 'error');
                    return false;
                }
                if (!pickupDate || !pickupTime) {
                    showNotification('Ë´ãÈÅ∏ÊìáÂèñÈ§êÊó•ÊúüÂíåÊôÇÈñì', 'error');
                    return false;
                }
                if (cart.length === 0) {
                    showNotification('Ë´ãËá≥Â∞ëÈÅ∏Êìá‰∏ÄÂÄãÈ§êÈªû', 'error');
                    return false;
                }
                return true;
            };

            const handleSubmit = async () => {
                if (!validateForm()) return;
                
                setIsLoading(true);
                try {
                    const orderData = { 
                        customerName, 
                        customerPhone,
                        items: cart, 
                        pickupTime: getFullPickupTime(), 
                        deliveryAddress, 
                        notes,
                        totalAmount
                    };
                    
                    await onSubmitOrder(orderData);
                } catch (error) {
                    // ÈåØË™§Âú®Áà∂ÁµÑ‰ª∂ËôïÁêÜ
                } finally {
                    setIsLoading(false);
                }
            };

            const statusClasses = { 
                info: 'bg-blue-100 border-blue-400 text-blue-800', 
                success: 'bg-green-100 border-green-400 text-green-800', 
                warning: 'bg-yellow-100 border-yellow-400 text-yellow-800', 
                error: 'bg-red-100 border-red-400 text-red-800' 
            };

            const dateOptions = getDateOptions();
            const timeOptions = getTimeOptions();

            return React.createElement('div', { className: 'animate-fade-in' },
                React.createElement('div', {
                    className: `p-3 rounded-lg text-sm text-center border ${statusClasses[statusType]}`
                }, liffStatus),
                
                React.createElement('button', {
                    onClick: onViewHistory,
                    className: 'w-full text-center p-2.5 border border-blue-500 text-blue-600 rounded-md text-sm hover:bg-blue-500 hover:text-white transition-colors duration-200 mt-4 clickable-btn'
                }, 'üïí Êü•Ë©¢Ê≠∑Âè≤Ë®ÇÂñÆ'),
                
                React.createElement('div', { className: 'space-y-4 mt-4' },
                    React.createElement('div', null,
                        React.createElement('label', {
                            className: 'block mb-2 font-bold text-gray-700 text-sm'
                        }, 'ÂßìÂêç ', React.createElement('span', { className: 'text-red-500' }, '*')),
                        React.createElement('input', {
                            type: 'text',
                            value: customerName,
                            onChange: (e) => setCustomerName(e.target.value),
                            placeholder: 'Ëá™ÂãïÂ∏∂ÂÖ• LINE ÂêçÁ®±',
                            className: 'w-full p-3 border border-gray-300 rounded-lg text-sm focus:ring-green-500 focus:border-green-500'
                        })
                    ),
                    
                    React.createElement('div', null,
                        React.createElement('label', {
                            className: 'block mb-2 font-bold text-gray-700 text-sm'
                        }, 'ÊâãÊ©üËôüÁ¢º ', React.createElement('span', { className: 'text-red-500' }, '*')),
                        React.createElement('input', {
                            type: 'tel',
                            value: customerPhone,
                            onChange: (e) => setCustomerPhone(e.target.value),
                            placeholder: '0936220000',
                            className: 'w-full p-3 border border-gray-300 rounded-lg text-sm focus:ring-green-500 focus:border-green-500'
                        }),
                        React.createElement('p', { className: 'text-xs text-gray-500 mt-1' }, 'Ë´ãËº∏ÂÖ•09ÈñãÈ†≠ÁöÑ10‰ΩçÊâãÊ©üËôüÁ¢º')
                    ),
                    
                    React.createElement('div', null,
                        React.createElement('label', {
                            className: 'block mb-2 font-bold text-gray-700 text-sm'
                        }, 'ÂèñÈ§êÊó•Êúü ', React.createElement('span', { className: 'text-red-500' }, '*')),
                        React.createElement('select', {
                            value: pickupDate,
                            onChange: (e) => setPickupDate(e.target.value),
                            className: 'w-full p-3 border border-gray-300 rounded-lg text-sm focus:ring-green-500 focus:border-green-500'
                        },
                            React.createElement('option', { value: '' }, 'Ë´ãÈÅ∏ÊìáÂèñÈ§êÊó•Êúü'),
                            dateOptions.map(date => 
                                React.createElement('option', { key: date.value, value: date.value }, date.label)
                            )
                        )
                    ),
                    
                    React.createElement('div', null,
                        React.createElement('label', {
                            className: 'block mb-2 font-bold text-gray-700 text-sm'
                        }, 'ÂèñÈ§êÊôÇÈñì ', React.createElement('span', { className: 'text-red-500' }, '*')),
                        React.createElement('select', {
                            value: pickupTime,
                            onChange: (e) => setPickupTime(e.target.value),
                            className: 'w-full p-3 border border-gray-300 rounded-lg text-sm focus:ring-green-500 focus:border-green-500'
                        },
                            React.createElement('option', { value: '' }, 'Ë´ãÈÅ∏ÊìáÂèñÈ§êÊôÇÈñì'),
                            timeOptions.map(time => 
                                React.createElement('option', { key: time, value: time }, time)
                            )
                        ),
                        React.createElement('p', { className: 'text-xs text-gray-500 mt-1' }, 'ÁáüÊ•≠ÊôÇÈñì: 10:00 - 21:00')
                    ),
                    
                    React.createElement('div', null,
                        React.createElement('label', { className: 'block mb-2 font-bold text-gray-700 text-sm' }, 'Â§ñÈÄÅÂú∞Èªû (ÈÅ∏Â°´)'),
                        React.createElement('input', {
                            type: 'text',
                            value: deliveryAddress,
                            onChange: (e) => setDeliveryAddress(e.target.value),
                            placeholder: 'Â¶ÇÈúÄÂ§ñÈÄÅË´ãÂ°´ÂØ´Âú∞ÂùÄ',
                            className: 'w-full p-3 border border-gray-300 rounded-lg text-sm focus:ring-green-500 focus:border-green-500'
                        }),
                        React.createElement('p', { className: 'text-xs text-gray-500 mt-1' }, `‚Äª Â°´ÂØ´Âú∞ÂùÄÂ∞áË®àÁÆó $${DELIVERY_FEE} Â§ñÈÄÅË≤ª`)
                    ),
                    
                    React.createElement('div', null,
                        React.createElement('label', { className: 'block mb-2 font-bold text-gray-700 text-sm' }, 'ÂÇôË®ª (ÈÅ∏Â°´)'),
                        React.createElement('textarea', {
                            value: notes,
                            onChange: (e) => setNotes(e.target.value),
                            rows: 2,
                            placeholder: '‰æãÂ¶ÇÔºö‰∏çË¶ÅÈ¶ôËèú„ÄÅÂä†Ëæ£Á≠â',
                            className: 'w-full p-3 border border-gray-300 rounded-lg text-sm focus:ring-green-500 focus:border-green-500'
                        })
                    )
                ),
                
                React.createElement('div', { className: 'bg-gray-50 p-4 rounded-lg border border-gray-200 mt-4' },
                    React.createElement('h2', { className: 'text-center text-lg font-bold text-gray-800 mb-4' }, 'üìù ÈÅ∏ÊìáÈ§êÈªû'),
                    React.createElement('div', { className: 'space-y-3' },
                        menuItems.map(item => 
                            React.createElement(MenuItem, {
                                key: item.name,
                                item: item,
                                cartQuantity: getItemQuantity(item.name),
                                onUpdateCart: updateCart
                            })
                        )
                    )
                ),

                cart.length > 0 && React.createElement('div', { className: 'bg-yellow-50 p-4 rounded-lg border border-yellow-200 mt-4' },
                    React.createElement('div', { className: 'flex justify-between items-center mb-4' },
                        React.createElement('h2', { className: 'text-lg font-bold text-gray-800' },
                            `üõí Ë®ÇÂñÆÊòéÁ¥∞ (${cart.reduce((sum, item) => sum + item.quantity, 0)} È†Ö)`
                        ),
                        React.createElement('button', {
                            onClick: clearCart,
                            className: 'text-xs bg-red-100 text-red-600 hover:bg-red-500 hover:text-white font-semibold py-1 px-3 rounded-full clickable-btn'
                        }, 'üóëÔ∏è Ê∏ÖÁ©∫')
                    ),
                    
                    React.createElement('div', { className: 'space-y-2' },
                        cart.map(item => 
                            React.createElement('div', {
                                key: item.name,
                                className: 'flex justify-between items-center py-2 border-b border-gray-200'
                            },
                                React.createElement('div', null,
                                    React.createElement('p', { className: 'font-bold text-gray-800 text-sm' },
                                        `${item.icon} ${item.name}`
                                    ),
                                    React.createElement('p', { className: 'text-xs text-gray-500' },
                                        `$${item.price} x ${item.quantity}`
                                    )
                                ),
                                React.createElement('p', { className: 'font-bold text-green-600' },
                                    `$${item.price * item.quantity}`
                                )
                            )
                        )
                    )
                ),
                
                cart.length > 0 && React.createElement('div', { className: 'bg-green-50 p-4 rounded-lg border border-green-200 space-y-2 mt-4' },
                    React.createElement('div', { className: 'flex justify-between text-sm text-gray-600' },
                        React.createElement('span', null, 'È§êÈªûÁ∏ΩË®à:'),
                        React.createElement('span', null, `$${subtotal}`)
                    ),
                    deliveryFee > 0 && React.createElement('div', { className: 'flex justify-between text-sm text-gray-600' },
                        React.createElement('span', null, 'Â§ñÈÄÅË≤ª:'),
                        React.createElement('span', null, `$${deliveryFee}`)
                    ),
                    React.createElement('div', { className: 'flex justify-between font-bold text-lg text-gray-800 border-t border-gray-300 pt-3 mt-3' },
                        React.createElement('span', null, 'Á∏ΩÈáëÈ°ç:'),
                        React.createElement('span', null, `$${totalAmount}`)
                    )
                ),
                
                React.createElement('div', { className: 'mt-6' },
                    React.createElement('button', {
                        onClick: handleSubmit,
                        disabled: cart.length === 0 || isLoading,
                        className: 'w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg text-lg disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center clickable-btn'
                    },
                        isLoading ? [
                            React.createElement(LoadingSpinner, { key: 'spinner' }),
                            React.createElement('span', { key: 'text' }, 'ËôïÁêÜ‰∏≠...')
                        ] : '‚úÖ ÈÄÅÂá∫Ë®ÇÂñÆ'
                    )
                )
            );
        };

        // ‰∏ªÊáâÁî®ÁµÑ‰ª∂
        const App = () => {
            const [view, setView] = useState('order');
            const [submittedOrder, setSubmittedOrder] = useState(null);
            const [notification, setNotification] = useState({ message: '', type: 'success', visible: false });
            const [menuItems, setMenuItems] = useState([]);
            const [isMenuLoading, setIsMenuLoading] = useState(true);

            const showNotification = useCallback((message, type = 'success') => {
                setNotification({ message, type, visible: true });
            }, []);

            useEffect(() => {
                const fetchMenu = async () => {
                    try {
                        const items = await apiService.getMenu();
                        setMenuItems(items);
                    } catch (error) {
                        setMenuItems(DEFAULT_MENU);
                    } finally {
                        setIsMenuLoading(false);
                    }
                };
                fetchMenu();
            }, []);

            const handleSubmitOrder = async (orderData) => {
                try {
                    const result = await apiService.submitOrder(orderData);
                    const finalOrderData = { 
                        ...orderData, 
                        orderId: result.data?.orderId || 'ORD_' + Date.now()
                    };
                    setSubmittedOrder(finalOrderData);
                    setView('success');
                    showNotification('Ë®ÇÂñÆÊèê‰∫§ÊàêÂäüÔºÅÂ∑≤ÂÑ≤Â≠òÂà∞ Google Sheets');
                } catch (error) {
                    showNotification(`Ë®ÇÂñÆÊèê‰∫§Â§±ÊïóÔºö${error.message}`, 'error');
                    throw error;
                }
            };

            const handleNewOrder = () => {
                setSubmittedOrder(null);
                setView('order');
            };

            const renderContent = () => {
                if (isMenuLoading) {
                    return React.createElement('div', {
                        className: 'text-center py-20 flex flex-col items-center justify-center text-gray-600'
                    },
                        React.createElement(LoadingSpinner),
                        React.createElement('p', { className: 'mt-3 text-sm' }, 'Ê≠£Âú®ËºâÂÖ•ËèúÂñÆ...')
                    );
                }

                switch(view) {
                    case 'history':
                        return React.createElement(HistoryPage, {
                            onBack: () => setView('order'),
                            showNotification: showNotification
                        });
                    case 'success':
                        return submittedOrder && React.createElement(SuccessPage, {
                            orderData: submittedOrder,
                            onNewOrder: handleNewOrder,
                            showNotification: showNotification
                        });
                    default:
                        return React.createElement(OrderPage, {
                            menuItems: menuItems,
                            onSubmitOrder: handleSubmitOrder,
                            showNotification: showNotification,
                            onViewHistory: () => setView('history')
                        });
                }
            };

            return React.createElement('div', { className: 'p-4 min-h-screen flex items-center justify-center' },
                React.createElement('div', { className: 'container max-w-md mx-auto bg-white rounded-2xl shadow-2xl overflow-hidden' },
                    React.createElement('div', {
                        className: 'bg-[#fff3cd] border border-[#ffeaa7] rounded-t-2xl p-2.5 text-xs text-center text-[#856404]'
                    }, 'üîí ÂÆâÂÖ®Ë®ÇÈ§êÁ≥ªÁµ± - 24Â∞èÊôÇÊé•ÂèóÈ†êË®Ç'),

                    React.createElement('header', { className: 'bg-green-500 text-white p-5 text-center' },
                        React.createElement('h1', { className: 'text-2xl font-bold mb-1' }, 'üçú Âè∞ÁÅ£Â∞èÂêÉÂ∫ó'),
                        React.createElement('p', { className: 'text-sm opacity-90' }, 'LINE Âø´ÈÄüË®ÇÈ§ê - 24Â∞èÊôÇÊúçÂãô')
                    ),

                    React.createElement('main', { className: 'p-5 space-y-4' },
                        React.createElement(Notification, {
                            message: notification.message,
                            type: notification.type,
                            visible: notification.visible,
                            onClose: () => setNotification(prev => ({ ...prev, visible: false }))
                        }),
                        renderContent()
                    ),
                    
                    React.createElement('footer', {
                        className: 'bg-gray-100 p-4 text-center text-xs text-gray-500 border-t border-gray-200'
                    },
                        React.createElement('p', null, 'üìç ÁáüÊ•≠ÊôÇÈñì: 10:00 - 21:00 | üìû ËÅØÁµ°ÈõªË©±: 02-1234-5678')
                    )
                )
            );
        };

        // Ê∏≤ÊüìÊáâÁî®
        ReactDOM.render(React.createElement(App), document.getElementById('root'));
    </script>
</body>
</html>
